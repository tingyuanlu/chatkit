{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar HttpRequest = require(\"request\");\n\nvar url_1 = require(\"url\");\n\nvar common_1 = require(\"./common\");\n\nvar BaseClient =\n/** @class */\nfunction () {\n  function BaseClient(options) {\n    this.host = options.host;\n    this.port = options.port;\n    this.serviceName = options.serviceName;\n    this.serviceVersion = options.serviceVersion;\n    this.instanceId = options.instanceId;\n    this.sdkInfo = options.sdkInfo;\n  }\n  /**\n   * Make a HTTPS request to a service running on Elements.\n   * It will construct a valid elements URL from its serviceName, serviceVersion,\n   * and instanceId that were passed to the Instance at construction time.\n   */\n\n\n  BaseClient.prototype.request = function (options) {\n    var headers = this.sdkInfo.headers;\n\n    if (options.headers) {\n      for (var key in options.headers) {\n        headers[key] = options.headers[key];\n      }\n    }\n\n    if (options.jwt) {\n      headers['Authorization'] = \"Bearer \" + options.jwt;\n    }\n\n    var path = this.sanitizePath(\"services/\" + this.serviceName + \"/\" + this.serviceVersion + \"/\" + this.instanceId + \"/\" + options.path);\n    var host = url_1.format({\n      protocol: 'https',\n      hostname: this.host,\n      port: this.port,\n      pathname: path\n    });\n    return new Promise(function (resolve, reject) {\n      HttpRequest(host, {\n        body: JSON.stringify(options.body),\n        headers: headers,\n        method: options.method,\n        qs: options.qs,\n        useQuerystring: options.useQuerystring || false,\n        forever: true\n      }, function (error, response, body) {\n        if (error) {\n          reject(error);\n        } else {\n          var statusCode = response.statusCode;\n\n          if (statusCode >= 200 && statusCode <= 299) {\n            response.body = body;\n            resolve(response);\n          } else if (statusCode >= 300 && statusCode <= 399) {\n            reject(new Error(\"Unsupported Redirect Response: \" + statusCode));\n          } else if (statusCode >= 400 && statusCode <= 599) {\n            var errJson = JSON.parse(body);\n            var statusCode_1 = response.statusCode,\n                headers_1 = response.headers;\n            var error_1 = errJson.error,\n                error_description = errJson.error_description,\n                error_uri = errJson.error_uri;\n            reject(new common_1.ErrorResponse({\n              error: error_1,\n              error_description: error_description,\n              error_uri: error_uri,\n              headers: headers_1,\n              status: statusCode_1\n            }));\n          } else {\n            reject(new Error(\"Unsupported Response Code: \" + statusCode));\n          }\n        }\n      });\n    });\n  }; //Cleans up the path provided\n\n\n  BaseClient.prototype.sanitizePath = function (path) {\n    return path.replace(/\\/ /g, \"/\") //Replace space after a slash\n    .replace(/ $/, \"\") //Remove the trailing space\n    .replace(/[\\/]{2,}/g, \"/\") //Multiple slashes are now single slashes\n    .replace(/\\/$/, \"\"); //Remove trailing slash\n  };\n\n  return BaseClient;\n}();\n\nexports.default = BaseClient;","map":null,"metadata":{},"sourceType":"script"}