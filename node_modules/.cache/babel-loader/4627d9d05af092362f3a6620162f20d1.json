{"ast":null,"code":"'use strict';\n\nvar _classCallCheck = require(\"/Users/tingyuan.lu/chatkit/node_modules/@babel/runtime/helpers/classCallCheck\");\n\nvar _createClass = require(\"/Users/tingyuan.lu/chatkit/node_modules/@babel/runtime/helpers/createClass\");\n\nvar _possibleConstructorReturn = require(\"/Users/tingyuan.lu/chatkit/node_modules/@babel/runtime/helpers/possibleConstructorReturn\");\n\nvar _getPrototypeOf = require(\"/Users/tingyuan.lu/chatkit/node_modules/@babel/runtime/helpers/getPrototypeOf\");\n\nvar _inherits = require(\"/Users/tingyuan.lu/chatkit/node_modules/@babel/runtime/helpers/inherits\");\n\nvar EventEmitter = require('events');\n\nvar JSONB = require('json-buffer');\n\nvar loadStore = function loadStore(opts) {\n  var adapters = {\n    redis: '@keyv/redis',\n    mongodb: '@keyv/mongo',\n    mongo: '@keyv/mongo',\n    sqlite: '@keyv/sqlite',\n    postgresql: '@keyv/postgres',\n    postgres: '@keyv/postgres',\n    mysql: '@keyv/mysql'\n  };\n\n  if (opts.adapter || opts.uri) {\n    var adapter = opts.adapter || /^[^:]*/.exec(opts.uri)[0];\n    return new (require(adapters[adapter]))(opts);\n  }\n\n  return new Map();\n};\n\nvar Keyv =\n/*#__PURE__*/\nfunction (_EventEmitter) {\n  _inherits(Keyv, _EventEmitter);\n\n  function Keyv(uri, opts) {\n    var _this;\n\n    _classCallCheck(this, Keyv);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(Keyv).call(this));\n    _this.opts = Object.assign({\n      namespace: 'keyv',\n      serialize: JSONB.stringify,\n      deserialize: JSONB.parse\n    }, typeof uri === 'string' ? {\n      uri: uri\n    } : uri, opts);\n\n    if (!_this.opts.store) {\n      var adapterOpts = Object.assign({}, _this.opts);\n      _this.opts.store = loadStore(adapterOpts);\n    }\n\n    if (typeof _this.opts.store.on === 'function') {\n      _this.opts.store.on('error', function (err) {\n        return _this.emit('error', err);\n      });\n    }\n\n    _this.opts.store.namespace = _this.opts.namespace;\n    return _this;\n  }\n\n  _createClass(Keyv, [{\n    key: \"_getKeyPrefix\",\n    value: function _getKeyPrefix(key) {\n      return \"\".concat(this.opts.namespace, \":\").concat(key);\n    }\n  }, {\n    key: \"get\",\n    value: function get(key) {\n      var _this2 = this;\n\n      key = this._getKeyPrefix(key);\n      var store = this.opts.store;\n      return Promise.resolve().then(function () {\n        return store.get(key);\n      }).then(function (data) {\n        data = typeof data === 'string' ? _this2.opts.deserialize(data) : data;\n\n        if (data === undefined) {\n          return undefined;\n        }\n\n        if (typeof data.expires === 'number' && Date.now() > data.expires) {\n          _this2.delete(key);\n\n          return undefined;\n        }\n\n        return data.value;\n      });\n    }\n  }, {\n    key: \"set\",\n    value: function set(key, value, ttl) {\n      var _this3 = this;\n\n      key = this._getKeyPrefix(key);\n\n      if (typeof ttl === 'undefined') {\n        ttl = this.opts.ttl;\n      }\n\n      if (ttl === 0) {\n        ttl = undefined;\n      }\n\n      var store = this.opts.store;\n      return Promise.resolve().then(function () {\n        var expires = typeof ttl === 'number' ? Date.now() + ttl : null;\n        value = {\n          value: value,\n          expires: expires\n        };\n        return store.set(key, _this3.opts.serialize(value), ttl);\n      }).then(function () {\n        return true;\n      });\n    }\n  }, {\n    key: \"delete\",\n    value: function _delete(key) {\n      key = this._getKeyPrefix(key);\n      var store = this.opts.store;\n      return Promise.resolve().then(function () {\n        return store.delete(key);\n      });\n    }\n  }, {\n    key: \"clear\",\n    value: function clear() {\n      var store = this.opts.store;\n      return Promise.resolve().then(function () {\n        return store.clear();\n      });\n    }\n  }]);\n\n  return Keyv;\n}(EventEmitter);\n\nmodule.exports = Keyv;","map":null,"metadata":{},"sourceType":"script"}