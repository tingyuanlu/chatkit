{"ast":null,"code":"'use strict';\n\nvar deferToConnect = require('defer-to-connect');\n\nmodule.exports = function (request) {\n  var timings = {\n    start: Date.now(),\n    socket: null,\n    lookup: null,\n    connect: null,\n    upload: null,\n    response: null,\n    end: null,\n    error: null,\n    phases: {\n      wait: null,\n      dns: null,\n      tcp: null,\n      request: null,\n      firstByte: null,\n      download: null,\n      total: null\n    }\n  };\n\n  var handleError = function handleError(origin) {\n    var emit = origin.emit.bind(origin);\n\n    origin.emit = function (event) {\n      // Catches the `error` event\n      if (event === 'error') {\n        timings.error = Date.now();\n        timings.phases.total = timings.error - timings.start;\n        origin.emit = emit;\n      } // Saves the original behavior\n\n\n      for (var _len = arguments.length, args = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n        args[_key - 1] = arguments[_key];\n      }\n\n      return emit.apply(void 0, [event].concat(args));\n    };\n  };\n\n  var uploadFinished = false;\n\n  var onUpload = function onUpload() {\n    timings.upload = Date.now();\n    timings.phases.request = timings.upload - timings.connect;\n  };\n\n  handleError(request);\n  request.once('socket', function (socket) {\n    timings.socket = Date.now();\n    timings.phases.wait = timings.socket - timings.start;\n\n    var lookupListener = function lookupListener() {\n      timings.lookup = Date.now();\n      timings.phases.dns = timings.lookup - timings.socket;\n    };\n\n    socket.once('lookup', lookupListener);\n    deferToConnect(socket, function () {\n      timings.connect = Date.now();\n\n      if (timings.lookup === null) {\n        socket.removeListener('lookup', lookupListener);\n        timings.lookup = timings.connect;\n        timings.phases.dns = timings.lookup - timings.socket;\n      }\n\n      timings.phases.tcp = timings.connect - timings.lookup;\n\n      if (uploadFinished && !timings.upload) {\n        onUpload();\n      }\n    });\n  });\n  request.once('finish', function () {\n    uploadFinished = true;\n\n    if (timings.connect) {\n      onUpload();\n    }\n  });\n  request.once('response', function (response) {\n    timings.response = Date.now();\n    timings.phases.firstByte = timings.response - timings.upload;\n    handleError(response);\n    response.once('end', function () {\n      timings.end = Date.now();\n      timings.phases.download = timings.end - timings.response;\n      timings.phases.total = timings.end - timings.start;\n    });\n  });\n  return timings;\n};","map":null,"metadata":{},"sourceType":"script"}